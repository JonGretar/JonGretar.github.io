{
  "hash": "d662635a27bc7a1c713eef1cb9bf9cfb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Deforestation\"\ndescription: |\n  TidyTuesday is a weekly community event where many participants in the R \n  ecosystem join together to visualize a dataset. I decided to begin with an\n  older dataset from week 15 of 2021 that focuses on deforestation.\ndate: 2021-12-20\nimage: index_files/figure-html/forest-area-1.png\nbibliography: library.bib\ncategories:\n  - R\n  - TidyTuesday\n  - Forestry\noutput:\n  distill::distill_article:\n    toc: true\n    self_contained: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(\n  warning=FALSE,\n  code_folding=FALSE\n)\n```\n:::\n\n\n\n I've been wanting to play around in the\n [TidyTuesday](https://github.com/rfordatascience/tidytuesday) scene for a\n while now. The deforestation dataset [@deforestation2021] is obviously of\n specific interest to me as a forest science student so I chose that one to\n begin with. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.3     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(rmarkdown)\nlibrary(hrbrthemes)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNOTE: Either Arial Narrow or Roboto Condensed fonts are required to use these themes.\n      Please use hrbrthemes::import_roboto_condensed() to install Roboto Condensed and\n      if Arial Narrow is not on your system, please see https://bit.ly/arialnarrow\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggbump) # For the maps and rank graph\ntuesdata <- readRDS(\"posts/2021-12-20-deforestation/deforestation.data\")\n```\n:::\n\n\n\n## Rank of Northern Countries\n\nI'm gonna start it simple and the generate a simple ranked bump chart of the\nnet change of forestry of the northern European countries using\nggbump[@ggbump].\n\nFirst of it to filter in the northern countries that we wish to see. We also\nneed to filter out the 2015 data as there seem to be gaps in them. For each\nyear we proceed to use `rank()` to rank each country by the net change in\nforest area.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncountries <- c('Iceland', 'Finland', 'Sweden', 'Norway', 'Denmark')\n\nranked <- tuesdata$forest |> \n  filter(entity %in% countries) |> \n  filter(year <= 2010) |> \n  group_by(year) |> \n  mutate(rank = rank(-net_forest_conversion))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nranked |> paged_table()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"entity\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"code\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"year\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"net_forest_conversion\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"rank\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Denmark\",\"2\":\"DNK\",\"3\":\"1990\",\"4\":\"4020\",\"5\":\"3\"},{\"1\":\"Denmark\",\"2\":\"DNK\",\"3\":\"2000\",\"4\":\"1490\",\"5\":\"1\"},{\"1\":\"Denmark\",\"2\":\"DNK\",\"3\":\"2010\",\"4\":\"7640\",\"5\":\"3\"},{\"1\":\"Finland\",\"2\":\"FIN\",\"3\":\"1990\",\"4\":\"57030\",\"5\":\"1\"},{\"1\":\"Finland\",\"2\":\"FIN\",\"3\":\"2000\",\"4\":\"-20360\",\"5\":\"5\"},{\"1\":\"Finland\",\"2\":\"FIN\",\"3\":\"2010\",\"4\":\"33400\",\"5\":\"1\"},{\"1\":\"Iceland\",\"2\":\"ISL\",\"3\":\"1990\",\"4\":\"1280\",\"5\":\"4\"},{\"1\":\"Iceland\",\"2\":\"ISL\",\"3\":\"2000\",\"4\":\"1480\",\"5\":\"2\"},{\"1\":\"Iceland\",\"2\":\"ISL\",\"3\":\"2010\",\"4\":\"700\",\"5\":\"4\"},{\"1\":\"Norway\",\"2\":\"NOR\",\"3\":\"1990\",\"4\":\"-1900\",\"5\":\"5\"},{\"1\":\"Norway\",\"2\":\"NOR\",\"3\":\"2000\",\"4\":\"-1100\",\"5\":\"3\"},{\"1\":\"Norway\",\"2\":\"NOR\",\"3\":\"2010\",\"4\":\"7800\",\"5\":\"2\"},{\"1\":\"Sweden\",\"2\":\"SWE\",\"3\":\"1990\",\"4\":\"10000\",\"5\":\"2\"},{\"1\":\"Sweden\",\"2\":\"SWE\",\"3\":\"2000\",\"4\":\"-9000\",\"5\":\"4\"},{\"1\":\"Sweden\",\"2\":\"SWE\",\"3\":\"2010\",\"4\":\"-18600\",\"5\":\"5\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nWith this data it is pretty straight forward to use `geom_bump()` to generate a\nsimple bump map. I'm gonna use hrbrthemes[@hrbrthemes] as a base theme for my\ngraphs as it tends to be my default theme.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nranked |> \n  ggplot(aes(year, rank, color=entity, group=entity, label=entity)) +\n  geom_bump(\n    smooth=15, size=6, alpha=0.4\n  ) +\n  geom_text(\n    data = ( ranked |> filter(year==1990) ), \n    hjust = \"left\", color = \"black\", nudge_x = 0.1, size = 3\n  ) +\n  #geom_text(aes(label=net_forest_conversion), size=2, nudge_y = -0.2) +\n  scale_y_reverse() +\n  labs(\n    title = \"Rank of net forest change of nothern countries\",\n    y = \"Rank\",\n    x = \"Year\",\n    caption = \"Source: Our world in data\"\n  ) +\n  theme_ipsum_rc(grid = \"\", axis_title_size = 13) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/ranked-1.png){width=672}\n:::\n:::\n\n\n\nIt turns out that this was not a good way of viewing this data. But oh well. I\nwill leave it here nevertheless.\n\n## Countries with the largest change of forest area.\n\nNext to explore this same table I wish to generate a lollipop chart showing the\ncountries of the world with the lagest positive and negative change in forest\ncover. To do this I take countries the top 20 *absolute* values of net forest\nconversion, I reorder those by real net_forest_conversion and then prepare a\ntext for the coloring of negative or positive values.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nforest_countries <- tuesdata$forest |> \n  filter(year == 2010, entity != \"World\") |> \n  slice_max(abs(net_forest_conversion), n=20) |> \n  mutate(\n    country = fct_reorder(as.factor(entity), net_forest_conversion),\n    negative = if_else(net_forest_conversion <= 0, \"Negative rate\", \"Positive rate\")\n  ) |> \n  select(country, net_forest_conversion, negative)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nforest_countries |> paged_table()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"country\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"net_forest_conversion\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"negative\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"China\",\"2\":\"1936770\",\"3\":\"Positive rate\"},{\"1\":\"Brazil\",\"2\":\"-1539180\",\"3\":\"Negative rate\"},{\"1\":\"Australia\",\"2\":\"709680\",\"3\":\"Positive rate\"},{\"1\":\"Paraguay\",\"2\":\"-414250\",\"3\":\"Negative rate\"},{\"1\":\"Tanzania\",\"2\":\"-372000\",\"3\":\"Negative rate\"},{\"1\":\"Myanmar\",\"2\":\"-289710\",\"3\":\"Negative rate\"},{\"1\":\"United States\",\"2\":\"275000\",\"3\":\"Positive rate\"},{\"1\":\"India\",\"2\":\"266400\",\"3\":\"Positive rate\"},{\"1\":\"Argentina\",\"2\":\"-223400\",\"3\":\"Negative rate\"},{\"1\":\"Bolivia\",\"2\":\"-211760\",\"3\":\"Negative rate\"},{\"1\":\"Mozambique\",\"2\":\"-206430\",\"3\":\"Negative rate\"},{\"1\":\"Zambia\",\"2\":\"-188180\",\"3\":\"Negative rate\"},{\"1\":\"Chile\",\"2\":\"174160\",\"3\":\"Positive rate\"},{\"1\":\"Peru\",\"2\":\"-171050\",\"3\":\"Negative rate\"},{\"1\":\"Venezuela\",\"2\":\"-164400\",\"3\":\"Negative rate\"},{\"1\":\"Nigeria\",\"2\":\"-163310\",\"3\":\"Negative rate\"},{\"1\":\"Vietnam\",\"2\":\"134760\",\"3\":\"Positive rate\"},{\"1\":\"Colombia\",\"2\":\"-134630\",\"3\":\"Negative rate\"},{\"1\":\"Mexico\",\"2\":\"-122480\",\"3\":\"Negative rate\"},{\"1\":\"Turkey\",\"2\":\"109440\",\"3\":\"Positive rate\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nFrom this we can generate a basic lollipop chart using `geom_segment()` and\n`geom_point()` as the base for the lollipops. I also flip the coordinates as it\nis better than rotating the country labels to a near vertical position.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nforest_countries |> \n  ggplot(aes(country, abs(net_forest_conversion), color=negative)) +\n  geom_hline(aes(yintercept=0), alpha=0.1) +\n  geom_segment(aes(\n    y = 0,\n    x = country,\n    yend = abs(net_forest_conversion),\n    xend = country\n  ), show.legend=FALSE, size=1.5) +\n  geom_point(size=4) +\n  scale_y_comma(breaks=seq(0, 2500000, 500000), limits=c(0,2000000), suffix=\" ha\") +\n  labs(\n    title = \"Countries with the largest change of forest area\",\n    subtitle = \"Top 20 countries with absolute values of net forest conversion\",\n    caption = \"Source: Our world in data\",\n    x = \"Country\",\n    y = \"Net forest conversion\"\n  ) +\n  coord_flip(clip = 'off') +\n  theme_ipsum_rc(grid=\"Xx\", axis_title_size = 12, axis_text_size = 10,\n                 ) +\n  theme(\n    legend.position = \"top\", \n    legend.title = element_blank()\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/forest-area-1.png){width=672}\n:::\n:::\n\n\n\nI kind of like this one. The reason I chose to use the absolute values, instead\nof having the 0 in the middle, was to make it easier to compare the rate of\nchange. It highlights the crazy deforestation going on in Brazil and the even\ncrazier amount of forest being planted in China.\n\nTo see how I use this data for map making check out my [next\npost](/posts/2022-01-10-forests-of-europe/)\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}